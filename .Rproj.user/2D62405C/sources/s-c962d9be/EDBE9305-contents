<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Public Data Integration using Sfaira • SimBu</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Public Data Integration using Sfaira">
<meta property="og:description" content="SimBu">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SimBu</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simulator_documentation.html">Getting started with the pseudo-bulk simulator R package</a>
    </li>
    <li>
      <a href="../articles/simulator_input_output.html">Inputs &amp; Outputs</a>
    </li>
    <li>
      <a href="../articles/sfaira_vignette.html">Public Data Integration using Sfaira</a>
    </li>
    <li>
      <a href="../articles/simulator_scaling_factors.html">Introducing mRNA bias into simulations with scaling factors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Public Data Integration using Sfaira</h1>
                        <h4 data-toc-skip class="author">Alexander Dietrich</h4>
            
      
      
      <div class="hidden name"><code>sfaira_vignette.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SimBu</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="sfaira-integeration">Sfaira Integeration<a class="anchor" aria-label="anchor" href="#sfaira-integeration"></a>
</h2>
<p>This vignette will cover the integration of the public database Sfaria.<br></p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>As a public database, sfaira <span class="citation">(<a href="#ref-Fischer2020" role="doc-biblioref">Fischer et al. 2020</a>)</span> is used, which is a dataset and model repository for single-cell RNA-sequencing data. It gives access to about 233 datasets from human and mouse with more than 3 million cells in total. You can browse them interactively here: <a href="https://theislab.github.io/sfaira-portal/Datasets" class="external-link">https://theislab.github.io/sfaira-portal/Datasets</a>. Note that only annotated datasets will be downloaded!<br>
In order to use this database, we first need to install it. We recommend to use <a href="https://docs.conda.io/projects/conda/en/latest/index.html" class="external-link">conda</a> to create a new environment and install sfaira into this directory. This ensures that no other packages interfere with the installation.<br><em>Note:</em> currently the simulator seems to work only with the develop version of sfaira.<br>
A recommended step by step installation would look like this:</p>
<pre><code>conda create --name sfaira python=3.9 pip
conda activate sfaira
/path/to/conda/envs/sfaira/bin/pip install git+https://github.com/theislab/sfaira.git@main #this ensures that the correct pip is used</code></pre>
<p>Watch out that you are using pip inside of the new environment, not the global pip!<br>
Also, we recommend to use the latest sfaira version, at this time it is 0.3.9.<br></p>
<p>You do not need to activate the new conda environment each time in order to use it in the R package.<br>
To setup sfaira inside of the R package use this command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setup_list</span> <span class="op">&lt;-</span> <span class="fu">SimBu</span><span class="fu">::</span><span class="fu"><a href="../reference/setup_sfaira.html">setup_sfaira</a></span><span class="op">(</span>python_path <span class="op">=</span> <span class="st">"/path/to/.conda/envs/sfaira/bin/python3"</span>,
                                      env_name <span class="op">=</span> <span class="st">"sfaira"</span>, 
                                      basedir <span class="op">=</span> <span class="st">"/local/path/to/store/data/sfaira"</span><span class="op">)</span></code></pre></div>
<p>The <code>python_path</code> parameter is used to set the path to the python executable <strong>inside</strong> of the newly created conda environment. Similarly, the <code>env_name</code> parameter is the name of this newly created conda environment. These two parameters need to be set correctly, so that sfaira can be used later on. You can find out the python-path in a conda environment named <code>sfaira</code> like this:<br></p>
<pre><code>activate sfaira
which python3</code></pre>
<p>The third parameter describes the name of a directory in which the raw files, meta data and cached data from downloading datasets from sfaira are stored into.<br>
You need to save the output of the command above in a variable for later use.<br>
If you do not wish to use sfaira, just skip this step entirely.</p>
</div>
<div class="section level3">
<h3 id="creating-a-dataset">Creating a dataset<a class="anchor" aria-label="anchor" href="#creating-a-dataset"></a>
</h3>
<p>The simulator package works with two internally defined data-structures: <em>datasets</em> and <em>databases</em>.<br>
We will now create a dataset of samples from human pancreas using the <code>organisms</code> and <code>tissues</code> parameter. You can provide a single word (like we do here) or for example a list of tissues you want to download: <code>c("pancreas","lung")</code>. An additional parameter is the <code>assays</code> parameter, where you subset the database further to only download datasets from certain sequencing assays (for examples <code>Smart-seq2</code>).<br>
The <code>name</code> parameter is used later on to give each sample a unique name.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds_human_pancreas</span> <span class="op">&lt;-</span> <span class="fu">SimBu</span><span class="fu">::</span><span class="fu"><a href="../reference/dataset_sfaira_multiple.html">dataset_sfaira_multiple</a></span><span class="op">(</span>sfaira_setup <span class="op">=</span> <span class="va">setup_list</span>,
                                                        organisms <span class="op">=</span> <span class="st">"Homo sapiens"</span>, 
                                                        tissues <span class="op">=</span> <span class="st">"pancreas"</span>, 
                                                        name<span class="op">=</span><span class="st">"human_pancreas"</span><span class="op">)</span></code></pre></div>
<p>Currently there are two datasets in sfaira from human pancreas, which have cell-type annotation. The package will download them for you automatically and merge them together into a single expression matrix and a streamlined annotation table, which we can use for our simulation.<br>
It can happen, that some datasets from sfaira are not (yet) ready for the automatic download, an error message will then appear in R, telling you which file to download and where to put it.<br></p>
<p>If you wish to see all datasets which are included in sfaira you can use the following command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_datasets</span> <span class="op">&lt;-</span> <span class="fu">SimBu</span><span class="fu">::</span><span class="fu"><a href="../reference/sfaira_overview.html">sfaira_overview</a></span><span class="op">(</span>setup_list <span class="op">=</span> <span class="va">setup_list</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_datasets</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.0 (2021-05-18)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 18.04.6 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1</span>
<span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] SimBu_0.99.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] rstudioapi_0.13   knitr_1.33        magrittr_2.0.1    R6_2.5.1         </span>
<span class="co">#&gt;  [5] ragg_1.2.2        rlang_1.0.2       fastmap_1.1.0     stringr_1.4.0    </span>
<span class="co">#&gt;  [9] tools_4.1.0       xfun_0.30         cli_3.2.0         jquerylib_0.1.4  </span>
<span class="co">#&gt; [13] htmltools_0.5.2   systemfonts_1.0.4 yaml_2.3.5        digest_0.6.27    </span>
<span class="co">#&gt; [17] rprojroot_2.0.2   pkgdown_2.0.2     textshaping_0.3.6 purrr_0.3.4      </span>
<span class="co">#&gt; [21] sass_0.4.1        fs_1.5.2          memoise_2.0.1     cachem_1.0.6     </span>
<span class="co">#&gt; [25] evaluate_0.14     rmarkdown_2.13    stringi_1.6.1     compiler_4.1.0   </span>
<span class="co">#&gt; [29] bslib_0.3.1       desc_1.4.1        jsonlite_1.7.2</span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Fischer2020" class="csl-entry">
Fischer, David S., Leander Dony, Martin König, Abdul Moeed, Luke Zappia, Sophie Tritschler, Olle Holmberg, Hananeh Aliee, and Fabian J. Theis. 2020. <span>“Sfaira Accelerates Data and Model Reuse in Single Cell Genomics.”</span> <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2020.12.16.419036" class="external-link">https://doi.org/10.1101/2020.12.16.419036</a>.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Dietrich.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
